<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login System</title>

<style>
/* ---------- BASIC RESET ---------- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
body {
    height: 100vh;
    background: 
        linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)),
        url("bg_img1.avif");
    background-size: cover;
    background-position: center;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: Arial, Helvetica, sans-serif;
    color: white;
}


/* ---------- CARD ---------- */
.card {
    width: 360px;
    background: #121212;
    padding: 30px;
    border-radius: 18px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.7);
}

.card h2 {
    text-align: center;
    margin-bottom: 20px;
    font-weight: normal;
}

/* ---------- INPUT ---------- */
.input-group {
    margin-bottom: 15px;
}

.input-group label {
    font-size: 13px;
    opacity: 0.8;
}

.input-group input {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    background: #1f1f1f;
    border: none;
    border-radius: 10px;
    color: white;
    outline: none;
}

/* ---------- BUTTON ---------- */
button {
    width: 100%;
    padding: 11px;
    border: none;
    border-radius: 20px;
    background: #0078d4;
    color: white;
    font-size: 14px;
    cursor: pointer;
    margin-top: 10px;
}

button:hover {
    background: #1690ff;
}

/* ---------- LINKS ---------- */
.links {
    margin-top: 15px;
    text-align: center;
    font-size: 13px;
}

.links a {
    color: #4da3ff;
    cursor: pointer;
    display: block;
    margin-top: 5px;
}

/* ---------- HIDE ---------- */
.hidden {
    display: none;
}

/*POP UP MESSAGE CSS STYLE*/

#popup {
    display: none; /* hidden initially */
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #0f172a;
    padding: 25px;
    border-radius: 12px;
    color: white;
    text-align: center;
    box-shadow: 0 0 20px black;
}

#popup button {
    margin-top: 15px;
    padding: 8px 20px;
    border-radius: 20px;
    background: #22c55e;
    border: none;
    cursor: pointer;
}
</style>
</head>

<body>


<div class="card">

    <!-- LOGIN -->
    <div id="loginBox">
        <h2>Login</h2>

        <div class="input-group">
            <label>Email</label>
            <input type="email" id="loginEmail" required>
        </div>

        <div class="input-group">
            <label>Password</label>
            <input type="password" id="loginPassword" required>
        </div>

        <button onclick="login()">Login</button>

        <div class="links">
            <a href="reset-request.html">Forgot password?</a>
            <a onclick="showCreate()">Create account</a>
        </div>
    </div>
    <!-- RESET PASSWORD -->
<div id="resetBox" class="hidden">
    <h2>Reset Password</h2>

    <div class="input-group">
        <label>Enter your email</label>
        <input type="email" id="resetEmail">
    </div>

    <button onclick="sendReset()">Send Reset Link</button>

    <div class="links">
        <a onclick="showLogin()">Back to login</a>
    </div>
</div>


    <!-- CREATE ACCOUNT -->
    <div id="createBox" class="hidden">
        <h2>Create Account</h2>

        <div class="input-group">
            <label>Name</label>
            <input type="text" id="createName">
        </div>

        <div class="input-group">
            <label>Email</label>
            <input type="email" id="createEmail">
        </div>

        <div class="input-group">
            <label>New Password</label>
            <input type="password" id="createPassword">
        </div>

        <div class="input-group">
            <label>Confirm Password</label>
            <input type="password" id="confirmPassword">
        </div>
        
        <button onclick="createAccount()">Create Account</button>

        <div class="links">
            <a onclick="showLogin()">Back to login</a>
        </div>
    </div>

<div id="popup">
    <p id="popupMessage"></p>
    <button onclick="closePopup()">OK</button>
</div>
<script>
/* ---------- ELEMENTS ---------- */
const popup = document.getElementById("popup");
const popupMessage = document.getElementById("popupMessage");

const loginBox = document.getElementById("loginBox");
const resetBox = document.getElementById("resetBox");
const createBox = document.getElementById("createBox");

/* ---------- POPUP ---------- */
function showPopup(message) {
  popupMessage.innerText = message;
  popup.style.display = "block";
}

function closePopup() {
  popup.style.display = "none";
}

/* ---------- EMAIL VALIDATION ---------- */
function isValidEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

/* ---------- LOGIN ---------- */
function login() {
  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value.trim();

  if (!email || !password) {
    showPopup("‚ùå Email and password required");
    return;
  }

  fetch("http://localhost:3000/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  })
  .then(res => res.json())
  .then(data => {
   if (data.success) {
  localStorage.setItem("user_id", data.user.id);   
  localStorage.setItem("name", data.user.name);
  localStorage.setItem("email", data.user.email);

  window.location.href = "masterpage.html";
}
 else {
      // üî• IMPORTANT: show backend message
      showPopup("‚ùå " + data.message);
    }
  })
  .catch(() => {
    showPopup("‚ùå Server error");
  });
}

/* ---------- CREATE ACCOUNT ---------- */
function createAccount() {
  const name = document.getElementById("createName").value.trim();
  const email = document.getElementById("createEmail").value.trim();
  const password = document.getElementById("createPassword").value;
  const confirm = document.getElementById("confirmPassword").value;

  if (!name || !email || !password || !confirm) {
    showPopup("‚ùå All fields are required");
    return;
  }

  if (!isValidEmail(email)) {
    showPopup("‚ùå Invalid email format");
    return;
  }

  if (password.length < 6) {
    showPopup("‚ùå Password must be at least 6 characters");
    return;
  }

  if (password !== confirm) {
    showPopup("‚ùå Passwords do not match");
    return;
  }

  fetch("http://localhost:3000/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, email, password })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      showPopup("‚úÖ Account created successfully! Please login.");
      setTimeout(showLogin, 1500);
    } else {
      showPopup("‚ùå " + (data.message || "Something went wrong"));
    }
  })
  .catch(() => {
    showPopup("‚ùå Server error during registration");
  });
}

/* ---------- RESET PASSWORD (UI ONLY) ---------- */
function sendReset() {
  const email = document.getElementById("resetEmail").value.trim();
  if (!isValidEmail(email)) {
    showPopup("‚ùå Enter a valid email");
    return;
  }
  showPopup("‚úÖ Reset link sent!");
}

/* ---------- PAGE SWITCH ---------- */
function showReset() {
  loginBox.classList.add("hidden");
  resetBox.classList.remove("hidden");
  createBox.classList.add("hidden");
}

function showCreate() {
  loginBox.classList.add("hidden");
  createBox.classList.remove("hidden");
  resetBox.classList.add("hidden");
}

function showLogin() {
  loginBox.classList.remove("hidden");
  resetBox.classList.add("hidden");
  createBox.classList.add("hidden");
}
</script>


</body>
</html>